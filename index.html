<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Carte des salles</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css">

<style>
  body, html { margin: 0; padding: 0; }
  #map { height: 100vh; width: 100vw; }
</style>
</head>
<body>

<div id="map"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<script>
const sheetURL = "https://docs.google.com/spreadsheets/d/1eihI2oIaFrH1-ro00QpUz_pGqMpG95-uh4Xy0hXwkC8/gviz/tq?tqx=out:json";

const map = L.map('map').setView([48.8566, 2.3522], 6);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution: '&copy; OpenStreetMap'
}).addTo(map);

function formatLink(url) {
  if (!url) return "#";
  if (url.startsWith("http")) return url;
  return "https://" + url;
}

fetch(sheetURL)
  .then(res => res.text())
  .then(text => {
    const json = JSON.parse(text.substring(47).slice(0, -2));
    const rows = json.table.rows;

    rows.forEach(r => {
      const name = r.c[0]?.v || "";
      const city = r.c[1]?.v || "";
      const zip = r.c[2]?.v || "";
      const link = r.c[9]?.v || "";
      const address = r.c[4]?.v || "";
      const lat = r.c[5]?.v;
      const lng = r.c[6]?.v;
      const addressLink = r.c[4]?.v || "";
      const contact = r.c[8]?.v || "";

      if (!lat || !lng) return;

      L.marker([lat, lng])
        .addTo(map)
        .bindPopup(`
          <strong>${name}</strong><br>
          ${address}<br>
          ${zip} ${city}<br><br>

          <a href="${formatLink(link)}" target="_blank">ğŸŒ Lien principal</a><br>
          <a href="${formatLink(addressLink)}" target="_blank">ğŸ“ Voir l'adresse</a><br><br>

          <em>Contact technique :</em><br>
          ${contact}
        `);
    });
  })
  .catch(err => {
    alert("Erreur de chargement du Google Sheet");
    console.error(err);
  });
</script>

</body>
</html>
